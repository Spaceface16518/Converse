<!doctype html>
<html>

<head>
  <title>Converse</title>
  <style>
    form {
      position: fixed;
      bottom: 0%;
      height: auto
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
  <script>
    $(function () {
      console.log('Connected to JQuery')
      let socket = io(window.location.host);
      console.log(`Connected to Socket.io on ${window.location.host}`)
      let assignedColor;
      socket.on('assign color', (color) => {
        assignedColor = color
      })
      $("form").submit(function () {

        socket.emit("message", {
          msg: $("#m").val(),
          color: assignedColor
        });
        console.log(`message sent: ${$("#m").val()}`)
        $("#m").val("");
        return false;
      });

      socket.on("message", function (data) {
        console.log(`message recieved: ${data.msg}`)

        function randNum() {
          let num = Math.random().toString(36).substr(2)
          console.log(`id: ${num}`)
          socket.emit('new id', num)
          return num


        }
        $("#messages").append($("<li>").css("background", data.color).attr('id', randNum()).text(data.msg));
      });
      socket.on('load', () => {
        console.log('Socket.io connection to server confirmed')
      })
      socket.on('scroll', id => {

        document.getElementById(id).scrollIntoView()

      });
    })
  </script>

  <script src="socket.io/socket.io.js" type="text/javascript"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>

<body>
  <div class="w3-rest" id="app">
    <div class="w3-rest w3-container w3-margin-bottom">
      <ul id="messages" class="w3-large w3-ul queue"></ul>
    </div>
    <form action="" class=" w3-rest w3-bar w3-rest" autocomplete="off">
      <div class="w3-container w3-rest">
        <input type="text" class="w3-input w3-leftbar w3-border-bottom w3-border-blue w3-rest" "Converse..." id="m">
      </div>
      <div class="w3-container w3-quarter">
        <button type="submit" class="w3-button w3-blue w3-border w3-cell w3-rest w3-hide-large">Send</button>
      </div>
    </form>
  </div>
</body>

</html>