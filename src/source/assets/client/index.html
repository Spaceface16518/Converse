<!doctype html>
<html>

<head>
  <title>Converse</title>
  <style>
    form {
      position: sticky;
      bottom: 0%;
      height: 20%
    }

    app {
      height: 100%;
      width: 100%
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
  <script>
    $(function () {
      console.log('Connected to JQuery')
      let socket = io(window.location.host);
      console.log(`Connected to Socket.io on ${window.location.host}`)
      let assignedColor;
      socket.on('assign color', (color) => {
        assignedColor = color
      })
      $("form").submit(function () {

        socket.emit("message", {
          msg: $("#m").val(),
          color: assignedColor
        });
        console.log(`message sent: ${$("#m").val()}`)
        $("#m").val("");
        return false;
      });

      socket.on("message", function (data) {
        console.log(`message recieved: ${data.msg}`)

        function randNum() {
          let num = Math.floor(Math.random() * 1000)
          socket.broadcast.emit('scroll', num);
          return num


        }
        $("#messages").prepend($("<li>").css("background", data.color).attr('id', randNum()).text(data.msg));
      });
      socket.on('load', () => {
        console.log('Socket.io connection to server confirmed')
      })
    });
  </script>

  <script src="socket.io/socket.io.js" type="text/javascript"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>

<body>
  <div class="w3-container" id="app">
    <div class="w3-container w3-margin-bottom">
      <ul id="messages" class="w3-large w3-ul queue"></ul>
    </div>



    <form action="" class="w3-panel w3-grey" autocomplete="off">


      <input class="w3-input w3-rightbar w3-border-bottom w3-border-blue" placeholder="Converse..." id="m">
      <button type="submit" class="w3-button w3-blue w3-border">Send</button>

    </form>

  </div>
</body>

<!-- Model html -->
<!--
<body>
  <ul id="messages"></ul>
  <form action="">
    <input id="m" />
    <button>Send</button>
  </form>
</body>
->
</html>