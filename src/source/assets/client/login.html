<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Join | Converse 2</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
  <script>
    $(document).ready(() => {
      $('#note').css('display', 'none')
      $("#warning").css('display', 'none')
      $('body').css('background-color', '#607d8b')
      $('#chat').focus(() => {
        $('#note').css('display', 'block')
        let str = Math.random().toString(36).slice(2).slice(0, 6)
        $('#chat').val(str)
        console.log(str)
      });

      $('form').submit(() => {
        let currentLocation = window.location;
        let queryParams = processInput()
        if (queryParams) {
          window.location.replace(`${currentLocation}chat${queryParams}`)
          return false
        } else {
          return false
        }
      })

      function processInput() {
        console.log('processInput called');

        query = {
          usr: encodeURIComponent($('#usr').val()),
          chat: encodeURIComponent($('#chat').val())
        }
        if (!query.chat) {
          $("#warning").css('display', 'block')
          return false
        } else {
          //setCookies(query)
          let queryString = `?usr=${query.usr}&chat=${query.chat}`
          return queryString
        }
      }

      function setCookies(query) {
        console.log('setCookies called');

        document.cookie(`usr=${query.usr}`)
        document.cookie(`chat=${query.chat}`)
      }
    })
  </script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="shortcut icon" href="favicon" type="image/x-icon">
</head>

<body>
  <header class="w3-container">
    <div class="w3-container w3-card w3-blue w3-margin w3-center">
      <h1 id="title">Welcome to Converse</h1>
      <h3>Free, unblocked web chatting for all!</h3>
      <p>Enter a display name and a chat identifier to begin</p>
    </div>
  </header>
  <div id="app" class="w3-container">
    <div class="w3-container">
      <form action="" class="w3-form w3-card w3-white w3-margin">
        <div class="w3-container">
          <label for="usr">Username</label>
          <input type="text" id="usr" class="w3-input w3-leftbar w3-border-blue" autocomplete="off" placeholder="Enter a display name...">
        </div>
        <div class="w3-container">
          <label for="chat">Chat ID</label>
          <input type="text" id="chat" placeholder="Enter a chat ID..." class="w3-input w3-leftbar w3-border-blue">
        </div>
        <div id="note" class="w3-container w3-panel w3-pale-blue w3-leftbar w3-border-blue">
          <p>To create a new chat, use the default chat ID provided</p>
        </div>
        <div id="warning" class="w3-container w3-panel w3-pale-red w3-leftbar w3-border-blue">
          <p>Please enter a Display name and Chat ID</p>
        </div>
        <button type="submit" id="submit" class="w3-btn w3-blue w3-margin">Converse!</button>
      </form>
    </div>
  </div>
  <div class="w3-container">
    <div class="w3-container w3-card w3-blue w3-margin w3-center">
      <p>This web application was designed by <strong>Amrit Rathie</strong> and is currently maintained by <strong>nobody</strong>.</p>
      <p>To report a bug, please contact me at <a href="mailto:tirma.eithar@gmail.com">tirma.eithar@gmail.com</a>.</p>
    </div>
  </div>
</body>

</html>